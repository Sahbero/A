<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Halka</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: radial-gradient(circle, #0f2027, #203a43, #2c5364);
    font-family: Arial, sans-serif;
    color: white;
  }
  #gameCanvas {
    display: block;
    margin: 0 auto;
    background: transparent;
  }
  #barrierButton {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: #444;
    border: none;
    cursor: pointer;
    outline: none;
    font-size: 16px;
    color: white;
    z-index: 10;
    position: relative;
  }
  #barrierRing {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 6px solid red;
    box-sizing: border-box;
    z-index: 5;
    transition: border-color 0.3s;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="barrierRing"></div>
<button id="barrierButton">B</button>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = { x: 400, y: 300, radius: 20, speed: 5 };
let enemies = [];
let score = 0;

let barrier = {
  active: false,
  duration: 3000, // 3 saniye
  cooldown: 5000, // 5 saniye
  ready: true,
  startTime: 0
};

const barrierBtn = document.getElementById("barrierButton");
const barrierRing = document.getElementById("barrierRing");

// Bariyer durumunu güncelle
function updateBarrierRing() {
  if (barrier.active) {
    let elapsed = Date.now() - barrier.startTime;
    let progress = elapsed / barrier.duration;
    let size = 100 - progress * 100;
    barrierRing.style.width = size + "px";
    barrierRing.style.height = size + "px";
    barrierRing.style.borderColor = "lime";
    if (progress >= 1) {
      barrier.active = false;
      barrier.ready = false;
      barrier.startTime = Date.now();
      barrierRing.style.width = "100px";
      barrierRing.style.height = "100px";
      barrierRing.style.borderColor = "red";
    }
  } else if (!barrier.ready) {
    let elapsed = Date.now() - barrier.startTime;
    if (elapsed >= barrier.cooldown) {
      barrier.ready = true;
      barrierRing.style.borderColor = "lime";
    }
  }
}

// Bariyer butonuna basıldığında
barrierBtn.addEventListener("click", () => {
  if (barrier.ready && !barrier.active) {
    barrier.active = true;
    barrier.startTime = Date.now();
    barrierRing.style.borderColor = "lime";
  }
});

// Düşman oluştur
function spawnEnemy() {
  let side = Math.floor(Math.random() * 4);
  let x, y;
  if (side === 0) { x = 0; y = Math.random() * canvas.height; }
  if (side === 1) { x = canvas.width; y = Math.random() * canvas.height; }
  if (side === 2) { x = Math.random() * canvas.width; y = 0; }
  if (side === 3) { x = Math.random() * canvas.width; y = canvas.height; }
  enemies.push({ x, y, radius: 15, speed: 2 });
}
setInterval(spawnEnemy, 1500);

// Çizimler
function drawPlayer() {
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  ctx.fillStyle = barrier.active ? "cyan" : "white";
  ctx.fill();
  ctx.closePath();
}
function drawEnemies() {
  enemies.forEach(e => {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
    ctx.fillStyle = "red";
    ctx.fill();
    ctx.closePath();
  });
}
function drawScore() {
  ctx.font = "20px Arial";
  ctx.fillStyle = "white";
  ctx.fillText("Skor: " + score, 20, 30);
}

// Hareketler
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function movePlayer() {
  if (keys["ArrowUp"]) player.y -= player.speed;
  if (keys["ArrowDown"]) player.y += player.speed;
  if (keys["ArrowLeft"]) player.x -= player.speed;
  if (keys["ArrowRight"]) player.x += player.speed;

  player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
  player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
}

// Çarpışma kontrolü
function checkCollisions() {
  enemies.forEach((e, i) => {
    let dx = player.x - e.x;
    let dy = player.y - e.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < player.radius + e.radius) {
      if (!barrier.active) {
        alert("Oyun Bitti! Skor: " + score);
        document.location.reload();
      } else {
        enemies.splice(i, 1);
        score += 10;
      }
    }
  });
}

// Oyun döngüsü
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  movePlayer();
  enemies.forEach(e => {
    let dx = player.x - e.x;
    let dy = player.y - e.y;
    let length = Math.sqrt(dx * dx + dy * dy);
    e.x += (dx / length) * e.speed;
    e.y += (dy / length) * e.speed;
  });

  drawPlayer();
  drawEnemies();
  drawScore();
  checkCollisions();

  updateBarrierRing();

  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
